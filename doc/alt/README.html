<h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><a href="#mdp1">mdp(1)</a></li>
</ul>
<ul>
<li><a href="#features">Features</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#meta">Meta</a></li>
</ul>
<ul>
<li><a href="#options">Options</a></li>
<li><a href="#partial">Partial</a></li>
</ul>
<ul>
<li><a href="#fields">Fields</a></li>
<li><a href="#literal">Literal</a></li>
<li><a href="#reference">Reference</a></li>
<li><a href="#object">Object</a></li>
<li><a href="#include">Include</a></li>
<li><a href="#binary">Binary</a></li>
<li><a href="#require">Require</a></li>
</ul>
<ul>
<li><a href="#environment">Environment</a></li>
</ul>
<ul>
<li><a href="#generator">Generator</a></li>
</ul>
<ul>
<li><a href="#middleware">Middleware</a></li>
<li><a href="#license">License</a></li>
</ul>
<h1 id="mdp-1-">mdp(1)</h1>
<p>Markdown partial processor.</p>
<p>Designed to generate markdown documents from a series of partials. </p>
<p>Read <a href="#partial">partial</a> to learn how to define partials or get a quick feel by checking the <a href="#configuration">configuration</a> that created this document, see <a href="#usage">usage</a> for an abbreviated look at the command line options.</p>
<h2 id="features">Features</h2>
<ul>
<li>Synchronize your <code>README</code> with your code.</li>
<li>Generate <code>markdown</code>, <code>html</code>, <code>man</code> and <code>txt</code> documents from partials.</li>
<li>Flexible middleware design, see <a href="#middleware">middleware</a>.</li>
<li>Generate a table of contents for markdown document(s).</li>
<li>Concatenate multiple markdown documents into a single file.</li>
<li>Include the output of a shell program, great for examples or program usage.</li>
<li>Convert relative links to absolute links so your readme documents work when displayed on the <a href="http://npmjs.org">npm</a> website.</li>
<li>Be pedantic in presentation, but lazy authoring. Ensure paragraphs are terminated with a period and start out title case.</li>
</ul>
<h2 id="install">Install</h2>
<pre><code>npm%20i%20-g%20mdp
</code></pre><h2 id="configuration">Configuration</h2>
<p>This document was generated with the following configuration (see <a href="https://github.com/tmpfs/mdp/blob/master/package.json">package.json</a>):</p>
<pre><code class="lang-json">%7B%0A%20%20%22title%22%3A%20%7B%0A%20%20%20%20%22ref%22%3A%20%22name%22%2C%0A%20%20%20%20%22format%22%3A%20%22%25s%281%29%22%0A%20%20%7D%2C%0A%20%20%22pedantic%22%3A%20true%2C%0A%20%20%22include%22%3A%20%22doc/readme%22%2C%0A%20%20%22require%22%3A%20%22lib%22%2C%0A%20%20%22gfm%22%3A%20true%2C%0A%20%20%22branch%22%3A%20%22master%22%2C%0A%20%20%22links%22%3A%20%22links.md%22%2C%0A%20%20%22toc%22%3A%20%22Table%20of%20Contents%22%2C%0A%20%20%22order%22%3A%20false%2C%0A%20%20%22base%22%3A%20%22https%3A//github.com/tmpfs/mdp%22%2C%0A%20%20%22env%22%3A%20true%2C%0A%20%20%22partial%22%3A%20%5B%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22ref%22%3A%20%22description%22%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22inc%22%3A%20%5B%0A%20%20%20%20%20%20%20%20%22introduction.md%22%2C%0A%20%20%20%20%20%20%20%20%22features.md%22%2C%0A%20%20%20%20%20%20%20%20%22install.md%22%0A%20%20%20%20%20%20%5D%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22title%22%3A%20%22Usage%22%2C%0A%20%20%20%20%20%20%22bin%22%3A%20%22mdp%20--help%22%2C%0A%20%20%20%20%20%20%22type%22%3A%20%22code%22%2C%0A%20%20%20%20%20%20%22footer%22%3A%20%22The%20program%20help%20output%20is%20also%20available%20as%20markdown%20see%20%5BMANUAL%5D%28/MANUAL.md%29%22%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22title%22%3A%20%22Configuration%22%2C%0A%20%20%20%20%20%20%22text%22%3A%20%22This%20document%20was%20generated%20with%20the%20following%20configuration%20%28see%20%5Bpackage.json%5D%28/package.json%29%29%3A%22%2C%0A%20%20%20%20%20%20%22ref%22%3A%20%22mdp%22%2C%0A%20%20%20%20%20%20%22stringify%22%3A%20true%2C%0A%20%20%20%20%20%20%22format%22%3A%20%22%60%60%60json%5Cn%25s%5Cn%60%60%60%22%2C%0A%20%20%20%20%20%20%22footer%22%3A%20%22***Note%20this%20is%20not%20necessarily%20the%20optimal%20configuration%20it%20is%20designed%20to%20showcase%20the%20partial%20functionality.***%22%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22inc%22%3A%20%22meta.md%22%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22req%22%3A%20%22defaults.js%22%2C%0A%20%20%20%20%20%20%22type%22%3A%20%22code%22%2C%0A%20%20%20%20%20%20%22language%22%3A%20%22javascript%22%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22inc%22%3A%20%5B%0A%20%20%20%20%20%20%20%20%22partial.md%22%2C%0A%20%20%20%20%20%20%20%20%22environment.md%22%2C%0A%20%20%20%20%20%20%20%20%22generator.md%22%0A%20%20%20%20%20%20%5D%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22title%22%3A%20%22Middleware%22%2C%0A%20%20%20%20%20%20%22inc%22%3A%20%22middleware.md%22%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22text%22%3A%20%22The%20%60inspect%60%20middleware%20is%20shown%20below%3A%22%2C%0A%20%20%20%20%20%20%22req%22%3A%20%22middleware/inspect.js%22%2C%0A%20%20%20%20%20%20%22type%22%3A%20%22code%22%2C%0A%20%20%20%20%20%20%22language%22%3A%20%22javascript%22%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22text%22%3A%20%22You%20can%20enable%20it%20by%20declaring%20it%20in%20the%20meta%20data%20%28or%20by%20using%20%60--inspect%60%29%3A%22%2C%0A%20%20%20%20%20%20%22obj%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%22middleware%22%3A%20%5B%0A%20%20%20%20%20%20%20%20%20%20%22inspect%22%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%22type%22%3A%20%22code%22%2C%0A%20%20%20%20%20%20%22language%22%3A%20%22json%22%0A%20%20%20%20%7D%2C%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22inc%22%3A%20%5B%0A%20%20%20%20%20%20%20%20%22license.md%22%2C%0A%20%20%20%20%20%20%20%20%22footer.md%22%0A%20%20%20%20%20%20%5D%0A%20%20%20%20%7D%0A%20%20%5D%0A%7D
</code></pre>
<p><strong><em>Note this is not necessarily the optimal configuration it is designed to showcase the partial functionality.</em></strong></p>
<h2 id="meta">Meta</h2>
<p>Meta data describes processing options and how you want to collate the partials.</p>
<h3 id="options">Options</h3>
<ul>
<li><code>generator</code>: A boolean that disables inclusion of the generator text.</li>
<li><code>title</code>: A string that sets the document title or a partial definition.</li>
<li><code>gfm</code>: A boolean that indicates that <a href="http://github.com">github</a> flavoured markdown is in use.</li>
<li><code>period</code>: The character used by the <a href="#pedantic">pedantic middleware</a>.</li>
<li><code>include</code>: A directory that is the base path for <a href="#include">include partials</a>.</li>
<li><code>require</code>: A directory that is the base path for <a href="#require">require partials</a>.</li>
<li><code>branch</code>: A branch name to use when resolving links that begin with <code>/</code> for <a href="http://github.com">github</a>, only applicable if <code>gfm</code> is set.</li>
<li><code>links</code>: The name of a links include file, resolved relative to <code>include</code>.</li>
<li><code>toc</code>: Enable the table of contents middleware with <code>true</code> or set to a string to include a title above the table of contents.</li>
<li><code>order</code>: A boolean that indicates the <code>toc</code> middleware should use ordered lists.</li>
<li><code>base</code>: Enable the absolute link middleware, specifies the base URL for absolute links.</li>
<li><code>hash</code>: A boolean that controls whether the absolute middleware operates on URLs that begin with <code>#</code>.</li>
<li><code>level</code>: An integer indicating the header level for <code>title</code> properties in partial definitions.</li>
<li><code>partial</code>: Array of partial definitions, see <a href="#partial">partial</a>.</li>
<li><code>env</code>: A boolean that indicates environment variables are substituted in partial contents. You may override this on a partial level by specifying <code>env</code> on a partial object, see <a href="#environment">environment</a>.</li>
</ul>
<pre><code class="lang-javascript">%7B%0A%20%20%22generator%22%3A%20%22Generated%20by%20%5Bmdp%281%29%5D%28https%3A//github.com/tmpfs/mdp%29.%22%2C%0A%20%20%22title%22%3A%20null%2C%0A%20%20%22gfm%22%3A%20true%2C%0A%20%20%22period%22%3A%20%22.%22%2C%0A%20%20%22pedantic%22%3A%20false%2C%0A%20%20%22include%22%3A%20null%2C%0A%20%20%22require%22%3A%20null%2C%0A%20%20%22branch%22%3A%20%22master%22%2C%0A%20%20%22links%22%3A%20null%2C%0A%20%20%22toc%22%3A%20false%2C%0A%20%20%22order%22%3A%20false%2C%0A%20%20%22base%22%3A%20null%2C%0A%20%20%22hash%22%3A%20false%2C%0A%20%20%22level%22%3A%202%2C%0A%20%20%22partial%22%3A%20null%2C%0A%20%20%22env%22%3A%20false%0A%7D
</code></pre>
<h3 id="partial">Partial</h3>
<p>A partial may be one of:</p>
<ul>
<li><code>literal|lit</code>: A string literal.</li>
<li><code>reference|ref</code>: A property reference.</li>
<li><code>object|obj</code>: A json or javascript object reference.</li>
<li><code>include|inc</code>: Include a file, normally a markdown document but not necessarily.</li>
<li><code>binary|bin</code>: Execute a command and use <code>stdout</code> as the content.</li>
<li><code>require|req</code>: Require a <code>.js</code> module or a <code>.json</code> file.</li>
</ul>
<h4 id="fields">Fields</h4>
<p>These are the common fields that apply to all partial types:</p>
<ul>
<li><code>title</code>: Injects a markdown heading for the partial, by default this is a level 2 heading although you may adjust this with the <code>level</code> configuration property.</li>
<li><code>text</code>: Markdown text to inject after the title but before the partial content.</li>
<li><code>type</code>: A type that indicates how the partial content should be wrapped, eg: <code>code</code>.</li>
<li><code>language</code>: A language to assign when wrapping as a <code>code</code> block.</li>
<li><code>footer</code>: Markdown text to inject after the partial content.</li>
<li><code>trim</code>: Remove leading and trailing whitespace from the transformed result.</li>
<li><code>stringify</code>: When referencing javascript objects (via <code>ref</code>, <code>req</code> etc.) this indicates that the result should be converted to <code>JSON</code> using <code>JSON.stringify</code>. The stringify implementation is circular reference safe and uses two spaces as the indentation but you may modify this with the <code>indent</code> property.</li>
<li><code>indent</code>: An integer indicating the number of spaces to indent when converting to a <code>JSON</code> string.</li>
<li><code>format</code>: A custom format string to use to wrap the partial result, should have a single <code>%s</code> that will be replaced with the partial content.</li>
<li><code>env</code>: If environment variable replacement has been enabled in the configuration then you may set this to <code>false</code> on a partial to disable environment variable replacement for the partial.</li>
</ul>
<h4 id="literal">Literal</h4>
<p>At it's simplest a partial may be a string that contains markdown text.</p>
<h4 id="reference">Reference</h4>
<p>A reference to a property in the meta definition file. This is useful when you are embedding the partial definition in <code>package.json</code> and wish to reference the existing meta data such as <code>name</code> or <code>description</code>.</p>
<h4 id="object">Object</h4>
<p>A reference to an object or a json object definition.</p>
<h4 id="include">Include</h4>
<p>Include a file as a partial. Files are resolved relative to the <code>include</code> configuration directory, if the <code>include</code> configuration property is not set they are resolved relative to the current working directory. Typically this is a markdown document to include literally, but can also be used to wrap other files in markdown code blocks, useful for examples.</p>
<p>Note that when including files trailing whitespace is removed from the file contents before inclusion in the resulting document.</p>
<ul>
<li><code>trim</code>: A boolean that when set to <code>false</code> disables the default behaviour of removing trailing whitespace from the file contents.</li>
</ul>
<h4 id="binary">Binary</h4>
<p>Execute a command and include the command's <code>stdout</code> in the resulting document. If the command prints markdown then you can use that output, otherwise you can wrap the command's output as a markdown element or just include it literally. This is particularly useful when you want to include a program's help (<code>--help</code>) output as a section within a document.</p>
<p>Binaries inherit the environment of the parent process (<code>mdp</code>) and the current working directory. The following fields are specific to the <code>binary</code> partial type:</p>
<ul>
<li><code>stderr</code>: A boolean that indicates that the command <code>stderr</code> stream should be used instead of the <code>stdout</code> stream.</li>
<li><code>cmd</code>: A directory that becomes the working directory for the child process.</li>
<li><code>env</code>: An object containing properties to <em>append</em> to the environment for the child process.</li>
</ul>
<h4 id="require">Require</h4>
<p>Require a <code>js</code> module or a <code>json</code> file. Files are resolved relative to the <code>require</code> configuration directory, if the <code>require</code> configuration property is not set they are resolved relative to the current working directory.</p>
<h2 id="environment">Environment</h2>
<p>You may enable environment variable replacement by setting the <code>env</code> configuration property to <code>true</code>. If you wish to disable environment variable replacement for a partial set <code>env</code> to <code>false</code> for the partial.</p>
<p>Environment variables are replaced using the forms:</p>
<pre><code>%24variable%0A%24%7Bvariable%7D
</code></pre><p>If the referenced variable is not set then the variable reference is not replaced and will be visible in the result.</p>
<p>You may disable environment variable replacement by preceeding the dollar with a single backslash:</p>
<pre><code>%24variable%0A%24%7Bvariable%7D
</code></pre><p>When replacement is performed the backslash will be removed, resulting in literal variable references:</p>
<pre><code>%24variable%0A%24%7Bvariable%7D
</code></pre><h3 id="generator">Generator</h3>
<p>By default <code>mdp(1)</code> will append a <em>generator</em> message to the end of the document, it is nice if you wish to leave it in to help spread the word, however you may disable this message by setting the <code>generator</code> property to <code>false</code>.</p>
<h2 id="middleware">Middleware</h2>
<p>Middleware functions are executed asynchronously once for each token encountered in the markdown document.</p>
<p>Implementations are passed a <code>meta</code> object which is the merged result of processing all the input configuration files (<code>--input</code>) and should return a closure that will be invoked once for each token in the document.</p>
<p>The closure function <em>must</em> be a named function and should return when zero arguments are passed so that function names may be used within error messages. It is passed the arguments:</p>
<ul>
<li><code>token</code>: The current token being processed.</li>
<li><code>tokens</code>: The list of all tokens in the document, you may use <code>tokens.peek()</code> to look ahead but you should not modify the array.</li>
<li><code>next</code>: A callback to invoke when the token has been processed, signature is: <code>next(err)</code>.</li>
</ul>
<p>If you pass an error to next the program will terminate immediately, failure to invoke <code>next()</code> will result in an error after a timeout (<code>--timeout</code>) has been exceeded.</p>
<p>The <code>inspect</code> middleware is shown below:</p>
<pre><code class="lang-javascript">function%20middleware%28meta%29%20%7B%0A%20%20return%20function%20inspect%28token%2C%20tokens%2C%20next%29%20%7B%0A%20%20%20%20if%28%21arguments.length%29%20return%3B%0A%20%20%20%20console.dir%28token%29%3B%0A%20%20%20%20next%28%29%3B%0A%20%20%7D%0A%7D
</code></pre>
<p>You can enable it by declaring it in the meta data (or by using <code>--inspect</code>):</p>
<pre><code class="lang-json">%7B%0A%20%20%22middleware%22%3A%20%5B%0A%20%20%20%20%22inspect%22%0A%20%20%5D%0A%7D
</code></pre>
<h2 id="license">License</h2>
<p>Everything is <a href="http://en.wikipedia.org/wiki/MIT_License">MIT</a>. Read the <a href="https://github.com/tmpfs/mdp/blob/master/LICENSE">license</a> if you feel inclined.</p>
<p>This program was built using the <a href="https://github.com/cli-kit/cli-command">command</a> module, if you care for excellent documentation and write command line interfaces you should check it out.</p>
<p>Generated by <a href="https://github.com/tmpfs/mdp">mdp(1)</a>.</p>
